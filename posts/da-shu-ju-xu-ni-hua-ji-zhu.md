---
title: '【工业与大数据】 虚拟化技术'
date: 2020-02-01 21:58:08
tags: [大数据]
published: true
hideInList: false
feature: /post-images/da-shu-ju-xu-ni-hua-ji-zhu.jpeg
isTop: false
---
### 为什么要虚拟化？
传统的虚拟化的目的主要是为了分区与抽象
- 分区 Partitioning
    - 分享：打破一个大资源
    - 服务器
- 抽象 Abstraction
    - 用一个指令集仿真另一个指令集（简而言之就是一种操作系统使用另外一种系统）
  
在云计算时代，虚拟化是为了资源池，安全，便于管理
- 资源池
    - 聚合：将多个资源结合起来
    - 合一：利于存储
    - 动态：快速分配（虚拟机）
- 隔离：保护消费者隔离其他租客
    - 例如虚拟专用网（VPN）
- 便于管理
    - 测试
    - 机动性
  
### 数据中心虚拟化的三个重要内容
- 计算虚拟化
  - 主操作系统：运行在真实机器上
  - 客户操作系统：运行在主操作系统之上
  - Hypervisor：支持运行在多个虚拟机上的软件
    - 类型1:运行在真实机器上，例如 Xen、VMWARE、ESXi
    - 类型2:运行在主操作系统，例如 MS Virtual PC
    - 类型0:1和2兼有，例如 Linux KVM
- 存储虚拟化
- 网络虚拟化

### 服务器虚拟化考虑的三个问题
- 指令集的翻译 二进制翻译
    - 如何快速执行
    - 如何执行需要更高权限的指令
- I/O设备的仿真
    - 如何让虚拟机操作系统访问不支持的硬件
    - 如何保护I/O性能
- 保护处理器的数据结构 **影子**处理器

### 虚拟化的核心问题：内存的保护管理
![](http://doc.xr1228.com//post-images/1580566550776.png)
计算机的内存映射是由MMU进行管理，当计算机虚拟化后运行在计算机上的多个系统对于MMU的控制方式是内存保护管理的重要问题。目前的解决方式：
- 半虚拟化：修改虚拟机操作系统，能不做操作就不要作
- 影子页表：
    - 拒绝客户操作系统对实际页表条目的任何访问
    - 捕获访问请求，在软件中仿真
- 硬件支持的虚拟化：
    - 二级地址转表（SLAT）
        - AMD AMD-V RVI
        - Intel VT-x EPT
  
> MMU是Memory Management Unit的缩写，中文名是内存管理单元，有时称作分页内存管理单元（英语：paged memory management unit，缩写为PMMU）。它是一种负责处理中央处理器（CPU）的内存访问请求的计算机硬件。它的功能包括虚拟地址到物理地址的转换（即虚拟内存管理）、内存保护、中央处理器高速缓存的控制。

### 网络虚拟化
#### 网络虚拟化的用途
![](http://doc.xr1228.com//post-images/1580567311758.png)
#### 网络虚拟化的举例 ： VLAN
最简单的目标：提供单一的二层网络
- 端口分数不同的VLAN
- 多个VLAN共享一个端口
    - Trunk模式
    - VLAN标签（12bits）：特殊的包头
    - 最多支持4096 VLAN
- VLAN的优劣与解决方案
    - 优势：标准，支持广泛，硬件成本低
    - 劣势：只能支持4096个VLAN
    - 新的标准：VxLAN
        - 通过三层隧道实现
        - 广播 -> 组播
        - Virtual Tunnel End Ppoints（VTEPs）负责打包和接包
#### 现代网络虚拟化技术：软件定义网络
- 传统网络
    - 控制面与数据面集成在同一个设备中
    - 不同网络设备之间通过协议决定如何转发
- 软件定义网络
    - 控制面集中管理，放在服务器中
    - 举例：OpenFlow协议，每一层交换机通过Controller确定数据流向
  ![](http://doc.xr1228.com//post-images/1580614390079.png)
    - 举例：Portland —— 大规模的虚拟二层网络的实现
        - 大型2层网络的挑战
            - 地址解析（ARP）：广播
            - 路由：广播
            - 转发：交换机要记住大量状态
            - 根源：MAC地址不连续
        - Portland实现
            - 与位置相关的虚拟地址
            - 通过SDN的地址解析
                - 网络截获所有ARP广播
                - 把无序的MAC地址改成与物理位置相关的地址
                - 转发数据包
                - 发给服务器之前，改回原来的MAC地址
  #### 存储虚拟化
  - 存储的意义
    - 独立于数据位置
        - 扩展性强，容量大
        - 易于管理（磁盘可集中存储）
        - 提升磁盘使用率
    - 独立与物理存储技术
        - 易于升级
        - 可用性的优化（多路径访问、冗余）
        - 易于维护（在线的后台备份、恢复）
- 存储虚拟化的三类接口
    - 块接口
        - 本例块存储
        - 远程块存储接口
    - 文件接口
        - 文件系统
        - 网络文件系统（NFS，CIFS，HDFS）
        - VFS
    - 对象存储接口
        - 亚马逊S3（基于http协议的REST接口）
        - OpenStack Swift
- 存储虚拟化的实现方式
    - SAN 存储区域网络
        - Storage Area Network
        - 存储服务器通过专用网络链接，例如光纤通道（FC）
    - NAS 网络附接存储
        - Network attached storage（NAS）
        - 存储服务器通过通用网络来访问，例如以太网
### 总结
- 优势
    - 统一、抽象的接口隐藏了复杂的物理硬件
    - 灵活，可以软件定义
    - 易于管理，更容易保证安全
- 问题
    - 虚拟化有一定的资源开销
    - 通常没有实现性能的隔离
    - 过多层的抽象：如何调试 ？
- 发展趋势：软件定义数据中心？
    - 网络功能虚拟化
        - 防火墙、入侵检测系统虚拟化
    - 资源的管理和调度
    - 其他资源的虚拟化：空调？供电？建筑？
    - 目标：性能+灵活性+管理



























